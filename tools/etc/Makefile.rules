PREFIX=/usr/local/lemberg

CC=clang -target lemberg 
CPPFLAGS=-I ${PREFIX}/include

AS=${PREFIX}/bin/as
LD=${PREFIX}/bin/ld
OBJCOPY=${PREFIX}/bin/objcopy

%.bc : %.c
	${CC} -c -emit-llvm ${CPPFLAGS} ${CFLAGS} -o $@ $^

%.s : %.bc
	llc -march=lemberg ${LLCFLAGS} -o $@ $<

%.s : %.c
	${CC} -S ${CPPFLAGS} ${CFLAGS} -o $@ $^

%.o : %.c
	${CC} -c ${CPPFLAGS} ${CFLAGS} -o $@ $^

%.o : %.s
	${CC} ${ASFLAGS} -o $@ $^

%.elf : %.o
	${CC} ${LDFLAGS} -o $@ $^ ${LDLIBS}

%.dat : %.elf
	${OBJCOPY} -d -o $@ $<

%.bin : %.elf
	${OBJCOPY} -b -o $@ $<
